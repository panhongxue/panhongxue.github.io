{"version":3,"file":"BackForwardCacheView.js","sourceRoot":"","sources":["../../../../../../front_end/panels/application/BackForwardCacheView.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as Platform from '../../core/platform/platform.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as LitHtml from '../../ui/lit-html/lit-html.js';\nimport * as ReportView from '../../ui/components/report_view/report_view.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport * as Protocol from '../../generated/protocol.js';\n\nconst UIStrings = {\n  /**\n   * @description Title text in Back-forward Cache view of the Application panel\n   */\n  mainFrame: 'Main Frame',\n  /**\n   * @description Section header text in Back-forward Cache view of the Application panel\n   */\n  lastMainFrameNavigation: 'Last Main Frame Navigation',\n  /**\n   * @description Title text in Back-forward Cache view of the Application panel\n   */\n  backForwardCacheTitle: 'Back-forward Cache',\n  /**\n   * @description Status text for the status of the main frame\n   */\n  unavailable: 'unavailable',\n  /**\n   * @description Entry name text in the Back-forward Cache view of the Application panel\n   */\n  url: 'URL',\n  /**\n   * @description Entry name text in the Back-forward Cache view of the Application panel\n   */\n  bfcacheStatus: 'Back-forward Cache Status',\n  /**\n   * @description Status text for the status of the back-forward cache status\n   */\n  unknown: 'unknown',\n  /**\n   * @description Status text for the status of the back-forward cache status indicating that\n   * the back-forward cache was not used and a normal navigation occured instead.\n   */\n  normalNavigation: 'Normal navigation',\n  /**\n   * @description Status text for the status of the back-forward cache status indicating that\n   * the back-forward cache was used to restore the page instead of reloading it.\n   */\n  restoredFromBFCache: 'Restored from back-forward cache',\n  /**\n   * @description Category text for the reasons which need to be cleaned up on the websites in\n   * order to make the page eligible for the back-forward cache.\n   */\n  pageSupportNeeded: 'Features preventing back-forward cache',\n  /**\n   * @description Category text for the reasons which need to be addressed on the chrome's side\n   * in order to make the page eligible for the back-forward cache.\n   */\n  chromeSupportNeeded: 'The last navigation was not cached because',\n  /**\n   * @description Explanation text for the reasons which will be supported in a future version\n   * of Chrome.\n   */\n  willBeSupported: '(Supported in a future version of Chrome)',\n};\nconst str_ = i18n.i18n.registerUIStrings('panels/application/BackForwardCacheView.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport class BackForwardCacheView extends UI.ThrottledWidget.ThrottledWidget {\n  constructor() {\n    super(true, 1000);\n    this.getMainResourceTreeModel()?.addEventListener(\n        SDK.ResourceTreeModel.Events.MainFrameNavigated, this.onBackForwardCacheUpdate, this);\n    this.getMainResourceTreeModel()?.addEventListener(\n        SDK.ResourceTreeModel.Events.BackForwardCacheDetailsUpdated, this.onBackForwardCacheUpdate, this);\n    this.update();\n  }\n\n  private onBackForwardCacheUpdate(): void {\n    this.update();\n  }\n\n  async doUpdate(): Promise<void> {\n    const data = {reportTitle: i18nString(UIStrings.backForwardCacheTitle)};\n    const html = LitHtml.html`\n      <${ReportView.ReportView.Report.litTagName} .data=${data as ReportView.ReportView.ReportData}>\n      ${this.renderMainFrameInformation(this.getMainFrame())}\n      </${ReportView.ReportView.Report.litTagName}>\n    `;\n    LitHtml.render(html, this.contentElement, {host: this});\n  }\n\n  private getMainResourceTreeModel(): SDK.ResourceTreeModel.ResourceTreeModel|null {\n    const mainTarget = SDK.TargetManager.TargetManager.instance().mainTarget();\n    return mainTarget?.model(SDK.ResourceTreeModel.ResourceTreeModel) || null;\n  }\n\n  private getMainFrame(): SDK.ResourceTreeModel.ResourceTreeFrame|null {\n    return this.getMainResourceTreeModel()?.mainFrame || null;\n  }\n\n  private renderMainFrameInformation(mainFrame: SDK.ResourceTreeModel.ResourceTreeFrame|null): LitHtml.TemplateResult {\n    if (!mainFrame) {\n      return LitHtml.html`<${ReportView.ReportView.ReportKey.litTagName}>${i18nString(UIStrings.mainFrame)}</${\n          ReportView.ReportView.ReportKey.litTagName}>\n      <${ReportView.ReportView.ReportValue.litTagName}>\n      ${i18nString(UIStrings.unavailable)}\n      </${ReportView.ReportView.ReportValue.litTagName}>`;\n    }\n    return LitHtml.html`\n      <${ReportView.ReportView.ReportSectionHeader.litTagName}>${i18nString(UIStrings.lastMainFrameNavigation)}</${\n        ReportView.ReportView.ReportSectionHeader.litTagName}>\n      <${ReportView.ReportView.ReportKey.litTagName}>${i18nString(UIStrings.url)}</${\n        ReportView.ReportView.ReportKey.litTagName}>\n      <${ReportView.ReportView.ReportValue.litTagName}>${mainFrame.url}</${\n        ReportView.ReportView.ReportValue.litTagName}>\n      <${ReportView.ReportView.ReportKey.litTagName}>${i18nString(UIStrings.bfcacheStatus)}</${\n        ReportView.ReportView.ReportKey.litTagName}>\n      <${ReportView.ReportView.ReportValue.litTagName}>${\n        this.renderBackForwardCacheStatus(\n            mainFrame.backForwardCacheDetails.restoredFromCache)}</${ReportView.ReportView.ReportValue.litTagName}>\n       ${this.maybeRenderExplanations(mainFrame.backForwardCacheDetails.explanations)}\n    `;\n  }\n\n  private renderBackForwardCacheStatus(status: boolean|undefined): Platform.UIString.LocalizedString {\n    switch (status) {\n      case true:\n        return i18nString(UIStrings.restoredFromBFCache);\n      case false:\n        return i18nString(UIStrings.normalNavigation);\n    }\n    return i18nString(UIStrings.unknown);\n  }\n\n  private maybeRenderExplanations(explanations: Protocol.Page.BackForwardCacheNotRestoredExplanation[]):\n      LitHtml.TemplateResult|{} {\n    if (explanations.length === 0) {\n      return LitHtml.nothing;\n    }\n\n    const pageSupportNeeded = explanations.filter(\n        explanation => explanation.type === Protocol.Page.BackForwardCacheNotRestoredReasonType.PageSupportNeeded);\n    const supportPending = explanations.filter(\n        explanation => explanation.type === Protocol.Page.BackForwardCacheNotRestoredReasonType.SupportPending);\n    const circumstantial = explanations.filter(\n        explanation => explanation.type === Protocol.Page.BackForwardCacheNotRestoredReasonType.Circumstantial);\n\n    // Disabled until https://crbug.com/1079231 is fixed.\n    // clang-format off\n    return LitHtml.html`\n      ${pageSupportNeeded.length + supportPending.length > 0 ?\n        LitHtml.html`\n          <${ReportView.ReportView.ReportKey.litTagName}>${\n            i18nString(UIStrings.pageSupportNeeded)\n          }</${ReportView.ReportView.ReportKey.litTagName}>\n          <${ReportView.ReportView.ReportValue.litTagName}>${\n            pageSupportNeeded.map(explanation => this.renderExplanation(explanation))\n          }</${ReportView.ReportView.ReportValue.litTagName}>\n        ` : LitHtml.nothing}\n      ${circumstantial.length > 0 ?\n        LitHtml.html`\n          <${ReportView.ReportView.ReportKey.litTagName}>${\n            i18nString(UIStrings.chromeSupportNeeded)\n          }</${ReportView.ReportView.ReportKey.litTagName}>\n          <${ReportView.ReportView.ReportValue.litTagName}>${\n            circumstantial.map(explanation => this.renderExplanation(explanation))\n          }</${ReportView.ReportView.ReportValue.litTagName}>\n        ` : LitHtml.nothing}\n    `;\n    // clang-format on\n  }\n\n  private renderExplanation(explanation: Protocol.Page.BackForwardCacheNotRestoredExplanation): LitHtml.TemplateResult {\n    return LitHtml.html`\n      <div>\n        ${explanation.reason}\n        ${\n        explanation.type === Protocol.Page.BackForwardCacheNotRestoredReasonType.SupportPending ?\n            i18nString(UIStrings.willBeSupported) :\n            LitHtml.nothing}\n      </div>\n    `;\n  }\n}\n"]}